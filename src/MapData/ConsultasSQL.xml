<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="sql">
 
    <resultMap id="result" type="Beans.TbVehiculos">
        <result property="id" column="ID"/>
        <result property="numeroPlaca" column="NUMERO_PLACA"/>
        <result property="fechaRegistro" column="FECHA_REGISTRO"/>
        <result property="idModelo" column="ID_MODELO"/>
    </resultMap>
    <resultMap id="resultPaciente" type="Beans.Paciente">
        <result property="sexo" column="sexo" />
        <result property="apellidoPaterno" column="apPaterno"/>
        <result property="apellidoMaterno" column="apMaterno"/>
        <result property="nombre" column="nombre"/>
        <result property="fechaNacimiento" column="fechaNac"  />
        <result property="telefono" column="telefono"/>
        <result property="direccion" column="direccion"/>
        <result property="tipoSangre" column="tipoSangre" />
        <result property="idPaciente" column="idPaciente"/> 
        <result property="curp" column="curp"/>
    </resultMap>
     <resultMap id="resultMedico" type="Beans.Medico">
        <result property="sexo" column="sexo" />
        <result property="apellidoPaterno" column="apPaterno"/>
        <result property="apellidoMaterno" column="apMaterno"/>
        <result property="nombre" column="nombre"/>
        <result property="fechaNacimiento" column="fechaNac"  />
        <result property="telefono" column="telefono"/>
        <result property="direccion" column="direccion"/>
        <result property="especialidad" column="especialidad" />
        <result property="cedulaProfesional" column="cedulaProf"/> 
    </resultMap>
    <resultMap id="resultMedicamento" type="Beans.Medicamento">
        <result property="idMedicamento" column="idMedicamento"/>
        <result property="nombre" column="nombre"/>
        <result property="presentacion" column="presentacion"/>
        <result property="dosis" column="dosis"/>
    </resultMap>
    <!-- AQUI VAN TODOS LOS SELECT-->
    <select id="obtenerUsuario" parameterType="Beans.Sesion" resultType="Beans.Sesion">
	select * 
	from sesion
	where usuario=#{usuario:VARCHAR}
        and password=#{password:VARCHAR}
    </select>
    
    
    
    <select id="getPaciente" resultMap="resultPaciente" parameterType="Beans.Paciente">
        SELECT * FROM paciente WHERE idPaciente = #{idPaciente};
    </select>
    
   
    <select id="getMedico" resultMap="resultMedico" parameterType="Beans.Medico">
        SELECT * FROM medico WHERE cedulaProf = #{cedulaProfesional};
    </select>
    <select id="nextConsulta" resultType="int">
        SELECT AUTO_INCREMENT FROM information_schema.TABLES
            WHERE TABLE_SCHEMA = 'sdstpobd' 
            AND TABLE_NAME = 'consultaMedica';
    </select>

    <select id="nextReceta" resultType="int">
        SELECT AUTO_INCREMENT FROM information_schema.TABLES
            WHERE TABLE_SCHEMA = 'sdstpobd' 
            AND TABLE_NAME = 'recetamedica';
    </select>
    <select id="getAllMedicamento" resultMap="resultMedicamento">
        SELECT * FROM medicamento
    </select>
    <select id="getUsuario" parameterType="Beans.Sesion" resultType="Beans.Sesion">
        select * from sesion where usuario=#{usuario:VARCHAR} and password=#{password:VARCHAR}
    </select>
    <select id="selMedico" parameterType="Beans.Medico" resultType="Beans.Medico">
        select 
            m.cedulaProf as cedulaProfesional,
            m.nombre,
            m.apPaterno as apellidoPaterno,
            m.apMaterno as apellidoMaterno,
            m.especialidad,
            m.telefono,
            m.fechaNac as fechaNacimiento,
            m.direccion,
            m.sexo
        from medico m 
        where m.cedulaProf=#{cedulaProfesional}
    </select>
    <select id="selSesion" parameterType="Beans.Sesion" resultType="Beans.Sesion">
        select 
            usuario,
            password,
            rol as admin,
            cedulaProfMedico as ced_prof
        from sesion where cedulaProfMedico=#{ced_prof}
    </select>
    <!-- AQUI VAN TODOS LOS INSERT-->
   <insert id="registrarPaciente" parameterType="Beans.Paciente" useGeneratedKeys="true" keyColumn="idPaciente" keyProperty="idPaciente">
    insert into paciente (nombre, apPaterno, apMaterno,tipoSangre,sexo,fechaNac,telefono,curp,direccion)
        VALUES (#{nombre}, #{apellidoPaterno}, #{apellidoMaterno}, #{tipoSangre}, #{sexo}, #{fechaNacimiento}, #{telefono}, #{curp},#{direccion});
   </insert>
   <insert id="registrarObservacionesPaciente" parameterType="Beans.Paciente">
    insert into observaciones (idPaciente,observacion)
        VALUES (#{idPaciente}, #{observacion});
   </insert>
    <insert id="registrarAlergiasPaciente" parameterType="Beans.Paciente">
    insert into alergiapaciente (idPaciente,alergia)
        VALUES (#{idPaciente}, #{alergia});
   </insert>
    <insert id="registrarPadecimientosPaciente" parameterType="Beans.Paciente">
    insert into padecimientocrondeg (idPaciente,enfermedad)
        VALUES (#{idPaciente}, #{padecimientos});
   </insert>
   <insert id="insertMedicamento" parameterType="Beans.Medicamento" useGeneratedKeys="true" keyColumn="idMedicamento" keyProperty="idMedicamento">
        INSERT INTO medicamento (nombre, presentacion)
        VALUES (#{nombre}, #{presentacion});        
    </insert>
    <insert id="insertReceta" parameterType="Beans.RecetaMedicaBean" useGeneratedKeys="true" keyColumn="idReceta" keyProperty="idReceta">
        INSERT INTO recetamedica (fecha, recomendaciones, idConsulta)
        VALUES (#{fecha}, #{recomendaciones}, #{idConsulta});        
    </insert>
    <insert id="insertRecetaMedicamento" parameterType="Beans.RecetaMedicaMedicamento">
        INSERT INTO recetamedicamedicamento (idReceta, idMedicamento, dosis)
        VALUES (#{idReceta}, #{idMedicamento}, #{dosis});        
    </insert>
        <insert id="insertConsulta" parameterType="Beans.ConsultaMedicaBean" useGeneratedKeys="true" keyColumn="idConsulta" keyProperty="idConsulta">
        INSERT INTO consultamedica (fecha, motivo, imgOjoIzq, imgOjoDer, cedProfMed,idPaciente)
        VALUES (#{fechaConsulta}, #{motivoConsulta}, #{ojoIzquierdo}, #{ojoDerecho}, #{cedulaMedico}, #{idPaciente});        
    </insert>
    <insert id="insertManifestacion" parameterType="Beans.ManifestacionBean" >
        INSERT INTO ManifestacionConsulta VALUES (#{idConsulta}, #{manifestacion});        
    </insert>
    <insert id="insertSesion" parameterType="Beans.Sesion">
        INSERT INTO sesion(usuario,password,rol,cedulaProfmedico)
        VALUES (#{usuario}, #{password}, #{admin}, #{ced_prof})
    </insert>
    <insert id="insertMedico" parameterType="Beans.Medico">
        INSERT INTO medico(cedulaProf,nombre,apPaterno,apMaterno,especialidad,telefono,fechaNac,direccion,sexo)
        VALUES(#{cedulaProfesional}, #{nombre}, #{apellidoPaterno}, #{apellidoMaterno}, #{especialidad}, #{telefono}, #{fechaNacimiento}, #{direccion}, #{sexo})
    </insert>
    <!-- AQUI VAN TODOS LOS UPDATE-->
    <update id="actMed" parameterType="Beans.Medico">
        update medico set
            especialidad='prueba'
        where cedulaProf=#{cedulaProfesional};
    </update>
    <update id="updateMedico" parameterType="Beans.Medico">
        update medico set
            nombre=#{nombre},
            apPaterno=#{apellidoPaterno},
            apMaterno=#{apellidoMaterno},
            especialidad=#{especialidad},
            telefono=#{telefono},
            fechaNac=#{fechaNacimiento},
            direccion=#{direccion},
            sexo=#{sexo}
        where cedulaProf=#{cedulaProfesional}
    </update>
    <update id="updateSesion" parameterType="Beans.Sesion">
        update sesion set
            usuario=#{usuario},
            password=#{password},
            rol=#{admin}
        where cedulaProfmedico=#{ced_prof}
    </update>
    
    
    <!-- AQUI VAN TODOS LOS DELETE-->
 
 
 
 
    
    
    
    
 
 
 
</mapper>